import{r as i,L as B,M as Q,B as g,g as ee,d as L,c as y,N as R,n as N,I as K,a as te,K as oe,G as ne,O as ae,P as se,T as le,F as ce,m as A}from"./index-BRYTmIyP.js";import{n as b,t as C,k as Y,D as re,H as ie,c as M,f as F,e as H,g as ue,b as X,w as $,r as x,I as de}from"./index-4pUri2OV.js";import{u as ve}from"./use-expose-N8why80i.js";import{T as D,H as fe}from"./constant-Co2M3aoe.js";import{p as j,P as me,c as ye}from"./on-popup-reopen-ebgq6Xfv.js";let he=2e3;const Ie=()=>++he,G={show:Boolean,zIndex:b,overlay:C,duration:b,teleport:[String,Object],lockScroll:C,lazyRender:C,beforeClose:Function,overlayStyle:Object,overlayClass:Y,transitionAppear:Boolean,closeOnClickOverlay:C},Be=Object.keys(G);function Oe(e,t){return e>t?"horizontal":t>e?"vertical":""}function Ce(){const e=i(0),t=i(0),o=i(0),r=i(0),n=i(0),l=i(0),a=i(""),c=i(!0),P=()=>a.value==="vertical",O=()=>a.value==="horizontal",u=()=>{o.value=0,r.value=0,n.value=0,l.value=0,a.value="",c.value=!0};return{move:d=>{const v=d.touches[0];o.value=(v.clientX<0?0:v.clientX)-e.value,r.value=v.clientY-t.value,n.value=Math.abs(o.value),l.value=Math.abs(r.value);const I=10;(!a.value||n.value<I&&l.value<I)&&(a.value=Oe(n.value,l.value)),c.value&&(n.value>D||l.value>D)&&(c.value=!1)},start:d=>{u(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY},reset:u,startX:e,startY:t,deltaX:o,deltaY:r,offsetX:n,offsetY:l,direction:a,isVertical:P,isHorizontal:O,isTap:c}}let k=0;const E="van-overflow-hidden";function Pe(e,t){const o=Ce(),r="01",n="10",l=u=>{o.move(u);const h=o.deltaY.value>0?n:r,w=ie(u.target,e.value),{scrollHeight:d,offsetHeight:v,scrollTop:I}=w;let f="11";I===0?f=v>=d?"00":"01":I+v>=d&&(f="10"),f!=="11"&&o.isVertical()&&!(parseInt(f,2)&parseInt(h,2))&&j(u,!0)},a=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",l,{passive:!1}),k||document.body.classList.add(E),k++},c=()=>{k&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",l),k--,k||document.body.classList.remove(E))},P=()=>t()&&a(),O=()=>t()&&c();re(P),B(O),Q(O),g(t,u=>{u?a():c()})}function U(e){const t=i(!1);return g(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const _=()=>{var e;const{scopeId:t}=((e=ee())==null?void 0:e.vnode)||{};return t?{[t]:""}:null},[ke,we]=M("overlay"),Se={show:Boolean,zIndex:b,duration:b,className:Y,lockScroll:C,lazyRender:C,customStyle:Object};var be=L({name:ke,props:Se,setup(e,{slots:t}){const o=i(),r=U(()=>e.show||!e.lazyRender),n=a=>{e.lockScroll&&j(a,!0)},l=r(()=>{var a;const c=H(ue(e.zIndex),e.customStyle);return X(e.duration)&&(c.animationDuration=`${e.duration}s`),N(y("div",{ref:o,style:c,class:[we(),e.className]},[(a=t.default)==null?void 0:a.call(t)]),[[K,e.show]])});return F("touchmove",n,{target:o}),()=>y(R,{name:"van-fade",appear:!0},{default:l})}});const Te=$(be),xe=H({},G,{round:Boolean,position:x("center"),closeIcon:x("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:x("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ge,p]=M("popup");var ze=L({name:ge,inheritAttrs:!1,props:xe,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:r}){let n,l;const a=i(),c=i(),P=U(()=>e.show||!e.lazyRender),O=te(()=>{const s={zIndex:a.value};if(X(e.duration)){const m=e.position==="center"?"animationDuration":"transitionDuration";s[m]=`${e.duration}s`}return s}),u=()=>{n||(n=!0,a.value=e.zIndex!==void 0?+e.zIndex:Ie(),t("open"))},h=()=>{n&&ye(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},w=s=>{t("clickOverlay",s),e.closeOnClickOverlay&&h()},d=()=>{if(e.overlay)return y(Te,A({show:e.show,class:e.overlayClass,zIndex:a.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},_(),{onClick:w}),{default:r["overlay-content"]})},v=s=>{t("clickCloseIcon",s),h()},I=()=>{if(e.closeable)return y(de,{role:"button",tabindex:0,name:e.closeIcon,class:[p("close-icon",e.closeIconPosition),fe],classPrefix:e.iconPrefix,onClick:v},null)};let f;const V=()=>{f&&clearTimeout(f),f=setTimeout(()=>{t("opened")})},Z=()=>t("closed"),W=s=>t("keydown",s),q=P(()=>{var s;const{round:m,position:S,safeAreaInsetTop:T,safeAreaInsetBottom:J}=e;return N(y("div",A({ref:c,style:O.value,role:"dialog",tabindex:0,class:[p({round:m,[S]:S}),{"van-safe-area-top":T,"van-safe-area-bottom":J}],onKeydown:W},o,_()),[(s=r.default)==null?void 0:s.call(r),I()]),[[K,e.show]])}),z=()=>{const{position:s,transition:m,transitionAppear:S}=e,T=s==="center"?"van-fade":`van-popup-slide-${s}`;return y(R,{name:m||T,appear:S,onAfterEnter:V,onAfterLeave:Z},{default:q})};return g(()=>e.show,s=>{s&&!n&&(u(),o.tabindex===0&&oe(()=>{var m;(m=c.value)==null||m.focus()})),!s&&n&&(n=!1,t("close"))}),ve({popupRef:c}),Pe(c,()=>e.show&&e.lockScroll),F("popstate",()=>{e.closeOnPopstate&&(h(),l=!1)}),ne(()=>{e.show&&u()}),ae(()=>{l&&(t("update:show",!0),l=!1)}),B(()=>{e.show&&e.teleport&&(h(),l=!0)}),se(me,()=>e.show),()=>e.teleport?y(le,{to:e.teleport},{default:()=>[d(),z()]}):y(ce,null,[d(),z()])}});const Le=$(ze);export{Le as P,Be as a,G as p,Ce as u};
